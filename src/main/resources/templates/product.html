<!DOCTYPE html>
<html lang="pt" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title th:text="${product.name} + ' - Total Electro'">Produto - Total Electro</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <!-- Font Awesome para ícones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        /* Estilos para el botón de idioma */
        .lang {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        .lang:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        .material-symbols-outlined {
            font-variation-settings:
            'FILL' 0,
            'wght' 400,
            'GRAD' 0,
            'opsz' 24
        }
        /* Estilos para os botões de ação */
        .btn-add-to-cart {
            background: linear-gradient(135deg, #f36f21 0%, #e05a0c 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
            width: 100%;
            margin-bottom: 1rem;
        }

        .btn-add-to-cart:hover {
            background: linear-gradient(135deg, #e05a0c 0%, #d1520a 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(243, 111, 33, 0.3);
        }

        .btn-add-to-cart:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-add-to-cart.loading {
            position: relative;
            color: transparent;
        }

        .btn-add-to-cart.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            border: 2px solid white;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Toast de notificação */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            border-left: 4px solid;
            min-width: 300px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.success {
            border-left-color: #28a745;
            color: #155724;
        }

        .toast.error {
            border-left-color: #dc3545;
            color: #721c24;
        }

        .toast .toast-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .toast .toast-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.5;
        }

        .toast .toast-close:hover {
            opacity: 1;
        }

        /* Melhorias nos botões de ação */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .btn-buy-now {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        }

        .btn-buy-now:hover {
            background: linear-gradient(135deg, #218838 0%, #1e7e34 100%);
        }

        /* Estilos para perguntas */
        .question-form-section {
            background: #f8f9fa;
            padding: 2rem 2rem 1.5rem 2rem;
            border-radius: 16px;
            margin-bottom: 2.5rem;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
        }
        .question-form-section h4 {
            margin-bottom: 1rem;
            color: #222;
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .question-form-section h4 i {
            color: #f36f21;
        }
        .question-form {
            display: flex;
            flex-direction: row;
            gap: 1rem;
            align-items: flex-end;
        }
        .question-form textarea {
            border: 1.5px solid #ced4da;
            border-radius: 8px;
            resize: vertical;
            font-size: 1rem;
            padding: 0.75rem 1rem;
            width: 100%;
            min-height: 48px;
            transition: border-color 0.2s;
        }
        .question-form textarea:focus {
            border-color: #f36f21;
            box-shadow: 0 0 0 0.1rem rgba(243, 111, 33, 0.10);
        }
        .question-form .btn-send-question {
            background: linear-gradient(135deg, #f36f21 0%, #e05a0c 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 2rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(243, 111, 33, 0.08);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: background 0.2s, transform 0.2s;
        }
        .question-form .btn-send-question:hover {
            background: linear-gradient(135deg, #e05a0c 0%, #d1520a 100%);
            transform: translateY(-2px) scale(1.04);
        }
        .question-form-section small {
            color: #888;
            margin-top: 0.5rem;
            display: block;
        }
        .questions-list {
            margin-top: 2rem;
        }
        .question-item {
            background: #fff;
            border: 1.5px solid #e9ecef;
            border-radius: 16px;
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 12px rgba(0,0,0,0.04);
            position: relative;
        }
        .question-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.5rem;
        }
        .question-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: #f36f21;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(243, 111, 33, 0.10);
        }
        .question-info {
            flex: 1;
        }
        .question-info strong {
            color: #222;
            font-weight: 700;
            font-size: 1.1rem;
        }
        .question-info small {
            color: #888;
            margin-left: 0.5rem;
            font-size: 0.95rem;
        }
        .question-status .badge {
            font-size: 0.8rem;
            border-radius: 6px;
            padding: 0.3em 0.8em;
            font-weight: 600;
        }
        .question-status .badge.bg-success {
            background: #28a745;
            color: #fff;
        }
        .question-status .badge.bg-warning {
            background: #ffc107;
            color: #222;
        }
        .question-content {
            margin-bottom: 1rem;
            font-size: 1.05rem;
            color: #333;
        }
        .answer-content {
            background: #f8f9fa;
            border-left: 5px solid #28a745;
            padding: 1.2rem 1.5rem;
            margin-top: 1.2rem;
            border-radius: 0 12px 12px 0;
            box-shadow: 0 2px 8px rgba(40,167,69,0.04);
            position: relative;
        }
        .answer-header {
            display: flex;
            align-items: center;
            gap: 0.7rem;
            margin-bottom: 0.5rem;
        }
        .answer-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #28a745;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
        }
        .answer-header strong {
            color: #28a745;
            font-weight: 700;
            font-size: 1.05rem;
        }
        .answer-header small {
            color: #888;
            margin-left: 0.5rem;
            font-size: 0.95rem;
        }
        .answer-content p {
            margin: 0.2rem 0 0 0;
            color: #333;
            font-size: 1.02rem;
        }
        .admin-actions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 0.5rem;
        }
        .admin-actions .btn {
            font-size: 0.95rem;
            border-radius: 6px;
            padding: 0.4rem 1.1rem;
        }
        .answer-form {
            margin-top: 1rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        .answer-form textarea {
            border: 1px solid #ced4da;
            border-radius: 6px;
            resize: vertical;
            font-size: 1rem;
        }
        .answer-form textarea:focus {
            border-color: #28a745;
            box-shadow: 0 0 0 0.1rem rgba(40, 167, 69, 0.10);
        }
        .no-questions {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
            background: #f8f9fa;
            border-radius: 12px;
            font-size: 1.1rem;
        }
        @media (max-width: 700px) {
            .question-form-section, .question-item {
                padding: 1rem;
            }
            .answer-content {
                padding: 1rem;
            }
        }
        .btn-review-product {
            background: linear-gradient(90deg, #f36f21 0%, #e05a0c 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 1rem 2.2rem;
            font-size: 1.15rem;
            font-weight: 700;
            box-shadow: 0 4px 16px rgba(243, 111, 33, 0.10);
            display: flex;
            align-items: center;
            gap: 0.7rem;
            transition: background 0.2s, transform 0.2s, box-shadow 0.2s;
            margin: 0 auto;
            margin-bottom: 2rem;
            cursor: pointer;
        }
        .btn-review-product:hover {
            background: linear-gradient(90deg, #e05a0c 0%, #d1520a 100%);
            transform: translateY(-2px) scale(1.04);
            box-shadow: 0 8px 24px rgba(243, 111, 33, 0.18);
        }
        .modal-content {
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.18);
            border: none;
            padding: 0.5rem 0 0 0;
        }
        .modal-header {
            border-bottom: 1px solid #f3f3f3;
            background: #f8f9fa;
            border-radius: 18px 18px 0 0;
            padding: 1.2rem 2rem 1rem 2rem;
        }
        .modal-title {
            font-weight: 800;
            font-size: 1.25rem;
            color: #f36f21;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-close {
            background: none;
            border: none;
            font-size: 1.7rem;
            color: #888;
            margin-left: auto;
            transition: color 0.2s;
        }
        .btn-close:hover {
            color: #f36f21;
        }
        .modal-body {
            padding: 2rem 2rem 1.5rem 2rem;
        }
        .star-rating {
            display: flex;
            gap: 0.4rem;
            font-size: 2.3rem;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }
        .star-rating .star {
            color: #ffc107;
            transition: transform 0.15s, color 0.15s;
            filter: drop-shadow(0 2px 4px rgba(243,111,33,0.08));
        }
        .star-rating .star.inactive {
            color: #e4e5e9;
        }
        .star-rating .star:hover, .star-rating .star:focus {
            transform: scale(1.18) rotate(-8deg);
            color: #f36f21;
        }
        #reviewForm .form-label {
            font-weight: 600;
            color: #444;
        }
        #reviewForm textarea {
            border-radius: 8px;
            font-size: 1.05rem;
            padding: 0.7rem 1rem;
            min-height: 70px;
        }
        #reviewForm input[type="file"] {
            border-radius: 8px;
            padding: 0.5rem;
        }
        #photoPreview {
            margin-top: 0.7rem;
            display: flex;
            gap: 0.7rem;
            flex-wrap: wrap;
        }
        #photoPreview img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 8px;
            border: 2px solid #f36f21;
            box-shadow: 0 2px 8px rgba(243,111,33,0.08);
        }
        .modal-footer {
            border-top: 1px solid #f3f3f3;
            background: #f8f9fa;
            border-radius: 0 0 18px 18px;
            padding: 1rem 2rem;
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        .modal-footer .btn-success {
            background: linear-gradient(90deg, #28a745 0%, #218838 100%);
            border: none;
            font-weight: 700;
            font-size: 1.08rem;
            border-radius: 8px;
            padding: 0.7rem 1.7rem;
            box-shadow: 0 2px 8px rgba(40,167,69,0.10);
            transition: background 0.2s, transform 0.2s;
        }
        .modal-footer .btn-success:hover {
            background: linear-gradient(90deg, #218838 0%, #1e7e34 100%);
            transform: translateY(-2px) scale(1.04);
        }
        .modal-footer .btn-secondary {
            border-radius: 8px;
            padding: 0.7rem 1.7rem;
            font-size: 1.08rem;
            font-weight: 600;
            border: none;
            background: #e9ecef;
            color: #444;
            transition: background 0.2s, color 0.2s;
        }
        .modal-footer .btn-secondary:hover {
            background: #f36f21;
            color: #fff;
        }
        @media (max-width: 700px) {
            .modal-body, .modal-header, .modal-footer {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            .btn-review-product {
                width: 100%;
                font-size: 1rem;
                padding: 1rem 0.5rem;
            }
        }
        .reviews-feed {
            display: flex;
            flex-direction: column;
            gap: 2.2rem;
            margin-top: 1.5rem;
        }
        .review-post {
            background: #fff;
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.07);
            border: 1.5px solid #e9ecef;
            padding: 2rem 2.2rem 1.5rem 2.2rem;
            display: flex;
            flex-direction: column;
            gap: 1.1rem;
            position: relative;
            transition: box-shadow 0.2s;
        }
        .review-post:hover {
            box-shadow: 0 8px 32px rgba(243,111,33,0.13);
        }
        .review-post-header {
            display: flex;
            align-items: center;
            gap: 1.1rem;
        }
        .review-post-avatar {
            width: 54px;
            height: 54px;
            border-radius: 50%;
            background: #f36f21;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.7rem;
            font-weight: 800;
            box-shadow: 0 2px 8px rgba(243,111,33,0.10);
        }
        .review-post-userinfo {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }
        .review-post-user {
            font-weight: 700;
            color: #222;
            font-size: 1.13rem;
        }
        .review-post-date {
            color: #888;
            font-size: 0.98rem;
        }
        .review-post-stars {
            display: flex;
            gap: 0.12rem;
            font-size: 1.45rem;
            margin-top: 0.2rem;
        }
        .review-post-stars .star { color: #ffc107; }
        .review-post-comment {
            font-size: 1.15rem;
            color: #333;
            font-weight: 500;
            margin: 0.2rem 0 0.5rem 0;
            word-break: break-word;
        }
        .review-post-photos {
            display: flex;
            gap: 0.7rem;
            flex-wrap: wrap;
            margin-top: 0.3rem;
        }
        .review-post-photos img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid #f36f21;
            box-shadow: 0 2px 8px rgba(243,111,33,0.08);
            transition: transform 0.15s;
            cursor: pointer;
        }
        .review-post-photos img:hover {
            transform: scale(1.08);
            z-index: 2;
        }
        @media (max-width: 700px) {
            .review-post {
                padding: 1.1rem 0.7rem 1rem 0.7rem;
            }
            .review-post-avatar {
                width: 40px; height: 40px; font-size: 1.1rem;
            }
            .review-post-user {
                font-size: 1rem;
            }
            .review-post-stars {
                font-size: 1.1rem;
            }
            .review-post-photos img {
                width: 60px; height: 60px;
            }
        }
    </style>
</head>
<body>
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- HEADER -->
    <th:block th:insert="~{fragments/header :: header}"></th:block>

    
       
 

    <!-- PRODUTO -->
    <div class="product-container">
        <div class="product-layout">
            <!-- Coluna da Imagem -->
            <div class="product-image-section">
                <div class="product-heart">
                    <span>♡</span>
                </div>
                <div class="product-main-image">
                    <img th:if="${product.imageUrl != null}" 
                         th:src="${product.imageUrl}" 
                         th:alt="${product.name}" 
                         class="main-product-img">
                    <div th:unless="${product.imageUrl != null}" class="no-image-placeholder">
                        <i class="bi bi-image"></i>
                        <p>Imagen no disponible</p>
                    </div>
                </div>
            </div>

            <!-- Coluna das Informações -->
            <div class="product-info-section">
                <div class="product-title-area">
                    <h1 th:text="${product.name}">Nome do Produto</h1>
                    <div class="product-rating">
                        <div class="stars">
                            <span>☆☆☆☆☆</span>
                        </div>
                    </div>
                </div>

                <div class="product-price-area">
                    <div class="price-display">
                        <span th:if="${product.discountPercent != null and product.discountPercent > 0}" class="discount-badge" style="background:#d9534f; color:#fff; font-weight:bold; border-radius:20px; padding:0.3em 1em; margin-right:0.7em;">-<span th:text="${product.discountPercent}"></span>%</span>
                        <span class="price-label">R$</span>
                        <span th:if="${product.discountPercent != null and product.discountPercent > 0}" class="price-old" style="text-decoration:line-through; color:#888; margin-right:0.5em;" th:text="${#numbers.formatDecimal(product.price, 1, 'POINT', 2, 'COMMA')}"></span>
                        <span class="price-value" th:if="${product.discountPercent != null and product.discountPercent > 0}" th:text="${#numbers.formatDecimal(product.price * (1 - product.discountPercent/100.0), 1, 'POINT', 2, 'COMMA')}"></span>
                        <span class="price-value" th:unless="${product.discountPercent != null and product.discountPercent > 0}" th:text="${#numbers.formatDecimal(product.price, 1, 'POINT', 2, 'COMMA')}"></span>
                        <span class="price-tax">IVA Incluído</span>
                    </div>
                </div>

                <div class="product-features">
                    <h3>Características principais</h3>
                    <ul>
                        <li>• Temperatura máxima: 150°C</li>
                        <li>• Uso industrial y eléctrico</li>
                        <li>• Aislamiento resistente al calor</li>
                        <li>• Alta durabilidad y fiabilidad</li>
                    </ul>
                </div>

                <div class="product-actions-area">
                    <div class="quantity-selector">
                        <button class="qty-btn minus" onclick="decreaseQuantity()">-</button>
                        <input type="number" value="1" min="1" class="qty-input" id="quantityInput">
                        <button class="qty-btn plus" onclick="increaseQuantity()">+</button>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn-add-to-cart" 
                                th:data-product-id="${product.id}"
                                th:data-product-name="${product.name}"
                                onclick="addToCart()">
                            <i class="fas fa-shopping-cart"></i>
                            Adicionar ao Carrinho
                        </button>
                        
                        <button class="btn-add-to-cart btn-buy-now" 
                                th:data-product-id="${product.id}"
                                onclick="buyNow()">
                            <i class="fas fa-bolt"></i>
                            Comprar Agora
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Seção de Abas -->
        <div class="product-tabs-section">
            <div class="tab-headers">
                <button class="tab-header active" data-tab="description">Descripción</button>
                <button class="tab-header" data-tab="questions">Perguntas <span th:if="${unansweredCount > 0}" class="badge bg-warning" th:text="${unansweredCount}"></span></button>
                <button class="tab-header" data-tab="opinions">Opiniones</button>
            </div>
            
            <div class="tab-content">
                <div class="tab-panel active" id="description">
                    <h3>Descripción del producto</h3>
                    <p th:text="${product.long_description}">Este cable Omerin de alta temperatura está diseñado para soportar condiciones extremas, ofreciendo una excelente resistencia al calor y garantizando un rendimiento superior en entornos exigentes. Con una resistencia térmica de hasta 150°C, es perfecto para aplicaciones industriales, equipos eléctricos, sistemas de calefacción y otros entornos donde se requiere una alta capacidad de resistencia térmica.</p>
                    
                    <h4>Características técnicas:</h4>
                    <ul>
                        <li><strong>Alta resistencia al calor:</strong> Soporta temperaturas de hasta 150°C, ideal para entornos de trabajo con temperaturas elevadas.</li>
                        <li><strong>Máxima calidad:</strong> Fabricado con materiales de última tecnología que aseguran una larga vida útil y un rendimiento confiable.</li>
                        <li><strong>Versatilidad de uso:</strong> Perfecto para aplicaciones industriales, maquinaria pesada, instalaciones eléctricas y más.</li>
                        <li><strong>Aislante de alta durabilidad:</strong> Su aislamiento asegura la protección y otros riesgos eléctricos en condiciones de alta temperatura.</li>
                    </ul>
                    
                    <p>Este cable es una opción confiable para aquellos que necesitan una solución de alta calidad para sus proyectos más exigentes. ¡Asegura la fiabilidad de tus instalaciones con el cable Omerin de alta temperatura!</p>
                    
                    <div class="product-specs">
                        <h4>Especificaciones:</h4>
                        <p><strong>Dimensiones:</strong> <span th:text="${product.dimensions}">Dimensiones del producto</span></p>
                    </div>
                </div>
                
                <div class="tab-panel" id="questions">
                    <h3 style="font-weight:700;font-size:1.3rem;margin-bottom:1.2rem;">Perguntas sobre este produto</h3>
                    <div class="question-form-section">
                        <h4><i class="fas fa-pen-nib"></i> Faça sua pergunta</h4>
                        <div class="question-form">
                            <textarea id="questionText" placeholder="Digite sua dúvida sobre este produto..." rows="2" class="form-control"></textarea>
                            <button onclick="submitQuestion()" class="btn-send-question">
                                <i class="fas fa-paper-plane"></i> Enviar Pergunta
                            </button>
                        </div>
                        <small>Sua pergunta será respondida por nossa equipe ou outros clientes.</small>
                    </div>
                    <div class="questions-list">
                        <div th:if="${questions.isEmpty()}" class="no-questions">
                            Nenhuma pergunta ainda. Seja o primeiro a perguntar!
                        </div>
                        <div th:each="question : ${questions}" class="question-item" th:data-question-id="${question.id}">
                            <div class="question-header">
                                <div class="question-avatar">
                                    <span th:text="${#strings.substring(question.userName,0,1)}">U</span>
                                </div>
                                <div class="question-info">
                                    <strong th:text="${question.userName}">Usuário</strong>
                                    <small th:text="${#temporals.format(question.createdAt, 'dd/MM/yyyy HH:mm')}">Data</small>
                                </div>
                                <div class="question-status">
                                    <span th:if="${question.isAnswered}" class="badge bg-success">Respondida</span>
                                    <span th:unless="${question.isAnswered}" class="badge bg-warning">Aguardando resposta</span>
                                </div>
                            </div>
                            <div class="question-content">
                                <p th:text="${question.question}">Pergunta</p>
                            </div>
                            <!-- Resposta (se existir) -->
                            <div th:if="${question.isAnswered}" class="answer-content">
                                <div class="answer-header">
                                    <div class="answer-avatar"><i class="fas fa-users"></i></div>
                                    <strong th:text="${question.answeredBy != null ? question.answeredBy : 'Equipe Total Electro'}">Equipe</strong>
                                    <small th:text="${#temporals.format(question.answeredAt, 'dd/MM/yyyy HH:mm')}">Data</small>
                                </div>
                                <p th:text="${question.answer}">Resposta</p>
                            </div>
                            <!-- Botões de admin (se logado como admin) -->
                            <div class="admin-actions" sec:authorize="hasRole('ADMIN')">
                                <button th:unless="${question.isAnswered}" onclick="showAnswerForm(this)" class="btn btn-sm btn-success">
                                    <i class="fas fa-reply"></i> Responder
                                </button>
                                <button onclick="deleteQuestion(this)" class="btn btn-sm btn-danger">
                                    <i class="fas fa-trash"></i> Excluir
                                </button>
                            </div>
                            <!-- Formulário de resposta (admin) -->
                            <div class="answer-form" style="display: none;">
                                <textarea class="form-control" rows="2" placeholder="Digite sua resposta..."></textarea>
                                <div class="mt-2">
                                    <button onclick="submitAnswer(this)" class="btn btn-sm btn-success">
                                        <i class="fas fa-check"></i> Enviar Resposta
                                    </button>
                                    <button onclick="cancelAnswer(this)" class="btn btn-sm btn-secondary">
                                        <i class="fas fa-times"></i> Cancelar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-panel" id="opinions">
                    <h3 style="font-weight:700;font-size:1.3rem;margin-bottom:1.2rem;">Opiniões de clientes</h3>
                    <div id="opinions-section">
                        <!-- Botão para avaliar (aparece só se permitido) -->
                        <div id="review-action" style="margin-bottom:2rem;display:none;">
                            <button class="btn-review-product" id="openReviewModal">
                                <i class="fas fa-star"></i> Avaliar este produto
                            </button>
                        </div>
                        <!-- Lista de avaliações -->
                        <div id="reviews-list" class="reviews-feed"></div>
                        <div id="no-reviews" class="no-questions" style="display:none;">Nenhuma avaliação ainda. Seja o primeiro a avaliar!</div>
                    </div>
                    <!-- Modal de avaliação -->
                    <div id="reviewModal" class="modal" tabindex="-1" style="display:none;">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title"><i class="fas fa-star"></i> Avaliar Produto</h5>
                                    <button type="button" class="btn-close" onclick="closeReviewModal()"></button>
                                </div>
                                <div class="modal-body">
                                    <form id="reviewForm" enctype="multipart/form-data">
                                        <div class="mb-3">
                                            <label class="form-label">Nota:</label>
                                            <div id="star-rating" class="star-rating"></div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Comentário:</label>
                                            <textarea class="form-control" name="comment" id="reviewComment" rows="3" maxlength="2000" required></textarea>
                                        </div>
                                        <div class="mb-3">
                                            <label class="form-label">Fotos (opcional, até 5):</label>
                                            <input type="file" name="photos" id="reviewPhotos" class="form-control" accept="image/*" multiple max="5">
                                            <div id="photoPreview" style="margin-top:0.5rem;display:flex;gap:0.5rem;"></div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" onclick="closeReviewModal()">Cancelar</button>
                                            <button type="submit" class="btn btn-success"><i class="fas fa-paper-plane"></i> Enviar Avaliação</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        // Carregar avaliações ao abrir aba
                        document.addEventListener('DOMContentLoaded', function() {
                            if (document.getElementById('opinions-section')) loadReviews();
                        });
                        function loadReviews() {
                            const productId = document.querySelector('.btn-add-to-cart').dataset.productId;
                            fetch(`/api/reviews/product/${productId}`)
                                .then(r => r.json())
                                .then(reviews => {
                                    const list = document.getElementById('reviews-list');
                                    const empty = document.getElementById('no-reviews');
                                    list.innerHTML = '';
                                    if (!reviews || reviews.length === 0) {
                                        empty.style.display = 'block';
                                        return;
                                    }
                                    empty.style.display = 'none';
                                    reviews.forEach(r => list.appendChild(renderReviewPost(r)));
                                });
                            // Verifica se pode avaliar (mock: sempre mostra botão, ajuste depois)
                            checkCanReview(productId);
                        }
                        function renderReviewPost(r) {
                            const card = document.createElement('div');
                            card.className = 'review-post';
                            card.innerHTML = `
                                <div class="review-post-header">
                                    <div class="review-post-avatar">${r.userName ? r.userName[0] : 'U'}</div>
                                    <div class="review-post-userinfo">
                                        <span class="review-post-user">${r.userName || 'Usuário'}</span>
                                        <span class="review-post-date">${r.createdAt ? new Date(r.createdAt).toLocaleString('pt-BR') : ''}</span>
                                        <div class="review-post-stars">${renderStars(r.rating)}</div>
                                    </div>
                                </div>
                                <div class="review-post-comment">${r.comment ? r.comment.replace(/</g,'&lt;') : ''}</div>
                                <div class="review-post-photos">${(r.photoUrls||[]).map(url => `<img src="${url}" alt="foto">`).join('')}</div>
                            `;
                            return card;
                        }
                        function renderStars(rating) {
                            let html = '';
                            for (let i = 1; i <= 5; i++) {
                                html += `<span class="star${i > rating ? ' inactive' : ''}"><i class="fas fa-star"></i></span>`;
                            }
                            return html;
                        }
                        // Modal de avaliação
                        document.addEventListener('click', function(e) {
                            if (e.target && e.target.id === 'openReviewModal') openReviewModal();
                        });
                        function openReviewModal() {
                            document.getElementById('reviewModal').style.display = 'block';
                            renderStarInput();
                        }
                        function closeReviewModal() {
                            document.getElementById('reviewModal').style.display = 'none';
                            document.getElementById('reviewForm').reset();
                            document.getElementById('photoPreview').innerHTML = '';
                        }
                        // Estrelas input
                        function renderStarInput() {
                            const starDiv = document.getElementById('star-rating');
                            starDiv.innerHTML = '';
                            let rating = 0;
                            for (let i = 1; i <= 5; i++) {
                                const star = document.createElement('span');
                                star.className = 'star inactive';
                                star.innerHTML = '<i class="fas fa-star"></i>';
                                star.onclick = () => {
                                    rating = i;
                                    Array.from(starDiv.children).forEach((s, idx) => {
                                        s.className = 'star' + (idx < i ? '' : ' inactive');
                                    });
                                    starDiv.dataset.rating = i;
                                };
                                starDiv.appendChild(star);
                            }
                        }
                        // Preview de fotos
                        document.getElementById('reviewPhotos').addEventListener('change', function(e) {
                            const files = Array.from(e.target.files).slice(0,5);
                            const preview = document.getElementById('photoPreview');
                            preview.innerHTML = '';
                            files.forEach(f => {
                                const img = document.createElement('img');
                                img.src = URL.createObjectURL(f);
                                img.style.width = '60px';
                                img.style.height = '60px';
                                img.style.objectFit = 'cover';
                                img.style.borderRadius = '6px';
                                preview.appendChild(img);
                            });
                        });
                        // Envio do formulário
                        document.getElementById('reviewForm').onsubmit = function(e) {
                            e.preventDefault();
                            const productId = document.querySelector('.btn-add-to-cart').dataset.productId;
                            const rating = document.getElementById('star-rating').dataset.rating || 0;
                            const comment = document.getElementById('reviewComment').value;
                            const photos = document.getElementById('reviewPhotos').files;
                            if (rating < 1) { showToast('error', 'Erro', 'Selecione uma nota!'); return; }
                            const formData = new FormData();
                            formData.append('rating', rating);
                            formData.append('comment', comment);
                            for (let i = 0; i < photos.length && i < 5; i++) {
                                formData.append('photos', photos[i]);
                            }
                            fetch(`/api/reviews/product/${productId}`, {
                                method: 'POST',
                                body: formData
                            })
                            .then(async r => {
                                if (!r.ok) {
                                    const err = await r.text();
                                    throw new Error(err);
                                }
                                return r.json();
                            })
                            .then(data => {
                                closeReviewModal();
                                showToast('success', 'Avaliação enviada!', 'Sua avaliação foi registrada com sucesso.');
                                setTimeout(() => loadReviews(), 500);
                            })
                            .catch(err => {
                                showToast('error', 'Erro', 'Erro ao enviar avaliação: ' + err.message);
                            });
                        };
                        // Mock: sempre mostra botão de avaliar
                        function checkCanReview(productId) {
                            document.getElementById('review-action').style.display = 'block';
                        }
                    </script>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-col">
                <strong>Informações de contato</strong><br>
                Rivera<br>
                Sarandí 821, 40000, Rivera, Uruguai<br>
                Tel.: +598 4623 5798<br>
                Email: total-electro@gmail.com
            </div>
            <div class="footer-col footer-logo-social">
                <img th:src="@{/images/logo.png}" alt="Total Electro">
                <div class="footer-socials">
                    <img th:src="@{/images/social/facebook.png}" alt="Facebook">
                    <img th:src="@{/images/social/instagram.png}" alt="Instagram">
                    <img th:src="@{/images/social/whatsapp.png}" alt="WhatsApp">
                </div>
            </div>
            <div class="footer-col">
                <strong>Perguntas frequentes</strong><br>
                Formas de pagamento:<br>
                <span class="footer-payments">
                    <img th:src="@{/images/payments/visa.png}" alt="Visa">
                    <img th:src="@{/images/payments/mastercard.png}" alt="Mastercard">
                </span>
            </div>
        </div>
        <div class="footer-bottom">
            <span>&copy; 2024 Total Electro</span>
            <span>Todos os direitos reservados</span>
        </div>
    </footer>

    <script>
        // Variáveis globais
        const productId = document.querySelector('.btn-add-to-cart').dataset.productId;
        const productName = document.querySelector('.btn-add-to-cart').dataset.productName;

        // Funções de quantidade
        function increaseQuantity() {
            const qtyInput = document.getElementById('quantityInput');
            qtyInput.value = parseInt(qtyInput.value) + 1;
        }

        function decreaseQuantity() {
            const qtyInput = document.getElementById('quantityInput');
            if (parseInt(qtyInput.value) > 1) {
                qtyInput.value = parseInt(qtyInput.value) - 1;
            }
        }

        // Função para adicionar ao carrinho
        function addToCart() {
            const quantity = document.getElementById('quantityInput').value;
            const button = document.querySelector('.btn-add-to-cart');
            
            console.log('Tentando adicionar ao carrinho:', { productId, productName, quantity });
            
            // Adicionar estado de loading
            button.classList.add('loading');
            button.disabled = true;
            
            // Obter o token CSRF
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            
            const headers = {
                'Content-Type': 'application/x-www-form-urlencoded',
            };
            
            // Adicionar CSRF token se disponível
            if (csrfToken && csrfHeader) {
                headers[csrfHeader.content] = csrfToken.content;
            }
            
            fetch('/cart/add', {
                method: 'POST',
                headers: headers,
                body: `productId=${productId}&quantity=${quantity}`
            })
            .then(response => {
                console.log('Resposta recebida:', response.status, response.statusText);
                
                // Se o status for 401 (Unauthorized), redirecionar para login
                if (response.status === 401) {
                    showToast('error', 'Login necessário', 'Você precisa estar logado para adicionar produtos ao carrinho.');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return null;
                }
                
                return response.text();
            })
            .then(data => {
                button.classList.remove('loading');
                button.disabled = false;
                
                if (data === null) {
                    // Já foi tratado o redirecionamento
                    return;
                }
                
                console.log('Dados da resposta:', data);
                
                if (data.startsWith('success')) {
                    const cartCount = data.split(':')[1];
                    updateCartCount(cartCount);
                    showToast('success', 'Produto adicionado!', `${quantity}x ${productName} foi adicionado ao carrinho.`);
                } else if (data.startsWith('error')) {
                    const errorMessage = data.split(':')[1];
                    console.error('Erro do servidor:', errorMessage);
                    showToast('error', 'Erro', errorMessage);
                } else {
                    console.error('Resposta inesperada:', data);
                    showToast('error', 'Erro', 'Resposta inesperada do servidor');
                }
            })
            .catch(error => {
                console.error('Erro na requisição:', error);
                button.classList.remove('loading');
                button.disabled = false;
                showToast('error', 'Erro', 'Erro ao adicionar produto ao carrinho: ' + error.message);
            });
        }

        // Função comprar agora (adiciona ao carrinho e vai para checkout)
        function buyNow() {
            const quantity = document.getElementById('quantityInput').value;
            const button = document.querySelector('.btn-buy-now');
            
            console.log('Tentando comprar agora:', { productId, productName, quantity });
            
            // Adicionar estado de loading
            button.classList.add('loading');
            button.disabled = true;
            
            // Obter o token CSRF
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            
            const headers = {
                'Content-Type': 'application/x-www-form-urlencoded',
            };
            
            // Adicionar CSRF token se disponível
            if (csrfToken && csrfHeader) {
                headers[csrfHeader.content] = csrfToken.content;
            }
            
            fetch('/cart/add', {
                method: 'POST',
                headers: headers,
                body: `productId=${productId}&quantity=${quantity}`
            })
            .then(response => {
                console.log('Resposta buy now recebida:', response.status, response.statusText);
                
                // Se o status for 401 (Unauthorized), redirecionar para login
                if (response.status === 401) {
                    showToast('error', 'Login necessário', 'Você precisa estar logado para comprar produtos.');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return null;
                }
                
                return response.text();
            })
            .then(data => {
                button.classList.remove('loading');
                button.disabled = false;
                
                if (data === null) {
                    // Já foi tratado o redirecionamento
                    return;
                }
                
                console.log('Dados da resposta buy now:', data);
                
                if (data.startsWith('success')) {
                    // Redirecionar para checkout
                    window.location.href = '/checkout/cart';
                } else if (data.startsWith('error')) {
                    const errorMessage = data.split(':')[1];
                    console.error('Erro do servidor buy now:', errorMessage);
                    showToast('error', 'Erro', errorMessage);
                } else {
                    console.error('Resposta inesperada buy now:', data);
                    showToast('error', 'Erro', 'Resposta inesperada do servidor');
                }
            })
            .catch(error => {
                console.error('Erro na requisição buy now:', error);
                button.classList.remove('loading');
                button.disabled = false;
                showToast('error', 'Erro', 'Erro ao processar compra: ' + error.message);
            });
        }

        // Função para atualizar contador do carrinho
        function updateCartCount(count) {
            const cartCountElement = document.getElementById('cartCount');
            if (cartCountElement) {
                cartCountElement.textContent = count;
                
                // Animação de destaque
                cartCountElement.style.transform = 'scale(1.5)';
                cartCountElement.style.background = '#28a745';
                setTimeout(() => {
                    cartCountElement.style.transform = 'scale(1)';
                    cartCountElement.style.background = '#fff';
                }, 300);
            }
        }

        // Função para mostrar toast de notificação
        function showToast(type, title, message) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            toast.innerHTML = `
                <div class="toast-header">
                    <span><i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${title}</span>
                    <button class="toast-close" onclick="hideToast(this)">&times;</button>
                </div>
                <div class="toast-body">${message}</div>
            `;
            
            toastContainer.appendChild(toast);
            
            // Mostrar toast
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            // Auto-hide após 5 segundos
            setTimeout(() => {
                hideToast(toast.querySelector('.toast-close'));
            }, 5000);
        }

        // Função para esconder toast
        function hideToast(button) {
            const toast = button.closest('.toast');
            toast.classList.remove('show');
            setTimeout(() => {
                toast.remove();
            }, 300);
        }

        // Funcionalidade das abas
        document.addEventListener('DOMContentLoaded', function() {
            // Funcionalidade dos botões de quantidade (mantendo código existente)
            const qtyInput = document.querySelector('.qty-input');
            const minusBtn = document.querySelector('.qty-btn.minus');
            const plusBtn = document.querySelector('.qty-btn.plus');
            
            if (minusBtn) {
                minusBtn.addEventListener('click', function() {
                    let value = parseInt(qtyInput.value) || 1;
                    if (value > 1) {
                        qtyInput.value = value - 1;
                    }
                });
            }
            
            if (plusBtn) {
                plusBtn.addEventListener('click', function() {
                    let value = parseInt(qtyInput.value) || 1;
                    qtyInput.value = value + 1;
                });
            }

            // Funcionalidade das abas
            const tabHeaders = document.querySelectorAll('.tab-header');
            const tabPanels = document.querySelectorAll('.tab-panel');

            tabHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const targetTab = this.dataset.tab;

                    // Remover classe active de todos os headers e panels
                    tabHeaders.forEach(h => h.classList.remove('active'));
                    tabPanels.forEach(p => p.classList.remove('active'));

                    // Adicionar classe active ao header clicado e ao panel correspondente
                    this.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });

            // Carregar contador do carrinho
            fetch('/cart/count')
                .then(response => response.text())
                .then(count => {
                    updateCartCount(count);
                })
                .catch(error => {
                    console.error('Erro ao carregar contador do carrinho:', error);
                });
        });

        // Funções para perguntas
        function submitQuestion() {
            const questionText = document.getElementById('questionText').value.trim();
            
            if (!questionText) {
                showToast('error', 'Erro', 'Por favor, digite sua pergunta.');
                return;
            }
            
            console.log('Enviando pergunta:', questionText, 'para produto:', productId);
            
            // Obter o token CSRF
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            
            const headers = {
                'Content-Type': 'application/x-www-form-urlencoded',
            };
            
            if (csrfToken && csrfHeader) {
                headers[csrfHeader.content] = csrfToken.content;
                console.log('CSRF token encontrado');
            } else {
                console.log('CSRF token não encontrado');
            }
            
            fetch(`/product/${productId}/question`, {
                method: 'POST',
                headers: headers,
                body: `question=${encodeURIComponent(questionText)}`
            })
            .then(response => {
                console.log('Resposta do servidor:', response.status, response.statusText);
                
                // Se o status for 401 (Unauthorized), redirecionar para login
                if (response.status === 401) {
                    showToast('error', 'Login necessário', 'Você precisa estar logado para fazer perguntas.');
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                    return null;
                }
                return response.text();
            })
            .then(data => {
                if (data === null) {
                    // Já foi tratado o redirecionamento
                    return;
                }
                
                console.log('Dados da resposta:', data);
                
                if (data.startsWith('success')) {
                    showToast('success', 'Pergunta enviada!', 'Sua pergunta foi enviada com sucesso.');
                    document.getElementById('questionText').value = '';
                    // Recarregar a página para mostrar a nova pergunta
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else if (data.startsWith('error')) {
                    const errorMessage = data.split(':')[1];
                    showToast('error', 'Erro', errorMessage);
                } else {
                    console.error('Resposta inesperada:', data);
                    showToast('error', 'Erro', 'Resposta inesperada do servidor');
                }
            })
            .catch(error => {
                console.error('Erro ao enviar pergunta:', error);
                showToast('error', 'Erro', 'Erro ao enviar pergunta: ' + error.message);
            });
        }

        function showAnswerForm(button) {
            const questionItem = button.closest('.question-item');
            const answerForm = questionItem.querySelector('.answer-form');
            const adminActions = questionItem.querySelector('.admin-actions');
            
            answerForm.style.display = 'block';
            adminActions.style.display = 'none';
        }

        function cancelAnswer(button) {
            const questionItem = button.closest('.question-item');
            const answerForm = questionItem.querySelector('.answer-form');
            const adminActions = questionItem.querySelector('.admin-actions');
            const textarea = answerForm.querySelector('textarea');
            
            answerForm.style.display = 'none';
            adminActions.style.display = 'block';
            textarea.value = '';
        }

        function submitAnswer(button) {
            const questionItem = button.closest('.question-item');
            const questionId = questionItem.dataset.questionId;
            const textarea = questionItem.querySelector('.answer-form textarea');
            const answer = textarea.value.trim();
            
            if (!answer) {
                showToast('error', 'Erro', 'Por favor, digite sua resposta.');
                return;
            }
            
            // Obter o token CSRF
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            
            const headers = {
                'Content-Type': 'application/x-www-form-urlencoded',
            };
            
            if (csrfToken && csrfHeader) {
                headers[csrfHeader.content] = csrfToken.content;
            }
            
            fetch(`/product/question/${questionId}/answer`, {
                method: 'POST',
                headers: headers,
                body: `answer=${encodeURIComponent(answer)}`
            })
            .then(response => response.text())
            .then(data => {
                if (data.startsWith('success')) {
                    showToast('success', 'Resposta enviada!', 'Sua resposta foi enviada com sucesso.');
                    // Recarregar a página para mostrar a resposta
                    setTimeout(() => {
                        location.reload();
                    }, 1500);
                } else if (data.startsWith('error')) {
                    const errorMessage = data.split(':')[1];
                    showToast('error', 'Erro', errorMessage);
                }
            })
            .catch(error => {
                console.error('Erro ao enviar resposta:', error);
                showToast('error', 'Erro', 'Erro ao enviar resposta: ' + error.message);
            });
        }

        function deleteQuestion(button) {
            if (!confirm('Tem certeza que deseja excluir esta pergunta?')) {
                return;
            }
            
            const questionItem = button.closest('.question-item');
            const questionId = questionItem.dataset.questionId;
            
            // Obter o token CSRF
            const csrfToken = document.querySelector('meta[name="_csrf"]');
            const csrfHeader = document.querySelector('meta[name="_csrf_header"]');
            
            const headers = {};
            
            if (csrfToken && csrfHeader) {
                headers[csrfHeader.content] = csrfToken.content;
            }
            
            fetch(`/product/question/${questionId}`, {
                method: 'DELETE',
                headers: headers
            })
            .then(response => response.text())
            .then(data => {
                if (data.startsWith('success')) {
                    showToast('success', 'Pergunta excluída!', 'A pergunta foi excluída com sucesso.');
                    questionItem.remove();
                } else if (data.startsWith('error')) {
                    const errorMessage = data.split(':')[1];
                    showToast('error', 'Erro', errorMessage);
                }
            })
            .catch(error => {
                console.error('Erro ao excluir pergunta:', error);
                showToast('error', 'Erro', 'Erro ao excluir pergunta: ' + error.message);
            });
        }
    </script>

</body>
</html> 